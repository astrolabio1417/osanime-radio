<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OsAnime Unofficial Radio</title>
    <meta property="og:site_name" content="OsAnime Unofficial Radio">
    <meta property="og:type" content="article">
    <meta property="og:title" content="OsAnime Unofficial Radio">
    <meta property="og:url" content="https://www.osanime-radio.render.com/">
    <meta property="og:image"
        content="https://dl3.wapkizfile.info/ddl/b1467d0a5330091b554e2d892f7e8308/osanime+wapkiz+com/002-(osanime.wapkiz.com).gif">
    <meta property="og:image:secure_url" content="https://www.osanime-radio.render.com/">
    <meta property="og:image:width" content="373">
    <meta property="og:image:height" content="222">
    <link rel="shortcut icon"
        href="https://dl3.wapkizfile.info/ddl/b1467d0a5330091b554e2d892f7e8308/osanime+wapkiz+com/002-(osanime.wapkiz.com).gif">
    <link rel="icon"
        href="https://dl3.wapkizfile.info/ddl/b1467d0a5330091b554e2d892f7e8308/osanime+wapkiz+com/002-(osanime.wapkiz.com).gif">
    <link rel="shortcut icon" type="image/x-icon"
        href="https://dl3.wapkizfile.info/ddl/b1467d0a5330091b554e2d892f7e8308/osanime+wapkiz+com/002-(osanime.wapkiz.com).gif">
    <style>
        .player-button {
            border-style: none;
        }

        .svg {
            max-width: 100%;
            max-height: 100%;
            height: 100%;
            width: 100%;
            color: turquoise;
        }

        .svg-container {
            height: 30px;
            width: 30px;
            padding: 20px 30px 20px 30px;
            border-radius: 20px;
        }

        .player-button:hover {
            background-color: lightskyblue;
        }

        .player-button:active {
            background-color: rgb(56, 179, 255);
        }
    </style>
</head>


<body>
    <div style="margin: auto; padding: auto;">

        <hr>
        <div id="current"></div>
        <button class="player-button" id="play-pause">
            <div class="svg-container">
                <img id="play-pause-svg" class="svg" src="/svg/play.svg" />
            </div>
        </button>
        <button class="player-button" id="volume-down">
            <div class="svg-container">
                <img id="vol-down-svg" class="svg" src="/svg/volume-down.svg" />
            </div>
        </button>
        <button class="player-button" id="volume-up">
            <div class="svg-container">
                <img id="vol-up-svg" class="svg" src="/svg/volume-up.svg" />
            </div>
        </button>
        <audio id="audio" controls src="/stream" preload="none" autoplay hidden></audio>
        <hr>
        <ol id="musics"></ol>
    </div>

    <script type="text/javascript">
        musicQueue()
        setInterval(musicQueue, 5000)
        let pauseTime = 0
        const audio = document.getElementById("audio")
        const playButton = document.getElementById("play-pause")
        const playButtonSvg = document.getElementById("play-pause-svg")
        const volUpButton = document.getElementById("volume-up")
        const volDownButton = document.getElementById("volume-down")

        function setPlayPause() {
            audio.paused ? audio.play() : audio.pause()
        }

        function onVolumeSet(set) {
            const volume = audio.volume

            if (set == 1) {
                const newVol = volume + 0.1
                audio.volume = newVol >= 1.0 ? 1.0 : newVol
            } else {
                const newVol = volume - 0.2
                audio.volume = newVol <= 0.0 ? 0.0 : newVol
            }
        }

        async function musicQueue() {
            const res = await fetch("/stream/queue")
            if (!res.ok) return
            const data = await res.json()
            const current = data[0]

            const currentDiv = document.getElementById("current")
            const title = document.createElement("h1")
            title.innerHTML = current?.title
            currentDiv.innerHTML = ""
            currentDiv.appendChild(title)

            const musicsOrderList = document.getElementById("musics")

            musicsOrderList.innerHTML = ""
            data.map(m => {
                const li = document.createElement("li")
                const div = document.createElement("div")
                div.innerHTML = m.title
                li.append(div)
                musicsOrderList.appendChild(li)
            })
        }

        function reloadPlayer() {
            console.log("audio error! reloading...");
            audio.src = ""
            audio.src = "/stream"
            audio.load()
            audio.play()
        }

        function onPlayPause() {
            audio.paused ? (playButtonSvg.src = "/svg/play.svg") : (playButtonSvg.src = "/svg/pause.svg")
        }

        playButton.addEventListener("click", () => setPlayPause())
        volUpButton.addEventListener("click", () => onVolumeSet(1))
        volDownButton.addEventListener("click", () => onVolumeSet(0))
        audio.addEventListener("play", () => {
            const now = new Date().getTime()
            const seconds = (now - pauseTime) / 1000
            const maxPause = 20
            if (pauseTime !== 0 && seconds >= maxPause) {
                reloadPlayer()
                pauseTime = 0
            }
            onPlayPause()
        })
        audio.addEventListener("pause", () => {
            pauseTime = new Date().getTime()
            onPlayPause()
        })
        audio.addEventListener("error", () => reloadPlayer)
    </script>
</body>

</html>